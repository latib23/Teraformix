import{g as C,r as n,j as e,L as S,C as D,a as v,b as A}from"./index-CFXgF25F.js";import{E as Q,l as $,u as F,a as I,C as w}from"./react-stripe.esm-CVc7cBOf.js";import{A as E}from"./alert-circle-Bm76VoOK.js";import{C as T}from"./credit-card-C5CQPZxd.js";import{S as P}from"./shield-check-Cy8fN0mD.js";const k=$(""),L=({quote:s,onSuccess:t})=>{var i,d;const h=F(),u=I(),[y,l]=n.useState(null),[c,p]=n.useState(!1),{content:g}=A(),j=async b=>{var o,m,x,r;if(b.preventDefault(),!(!h||!u||(p(!0),l(null),!u.getElement(w))))try{await new Promise(a=>setTimeout(a,1500)),await v.post(`/quotes/public/${s.id}/pay`,{paymentMethod:"CC",amount:s.total});try{const a={customer:s.customer,shippingAddress:s.shipping||((o=s.data)==null?void 0:o.shipping)||((m=s.customer)==null?void 0:m.address),billingAddress:s.billing||((x=s.data)==null?void 0:x.billing)||((r=s.customer)==null?void 0:r.address),items:s.items.map(f=>({productId:f.productId||f.sku,quantity:f.quantity,unitPrice:f.unitPrice})),status:"PENDING",paymentStatus:"PAID",total:s.total,source:"QUOTE_PAYMENT"};await v.post("/orders",a),console.log("Order created successfully from quote payment")}catch(a){console.error("Failed to create order after payment",a)}t()}catch(a){l(a.message||"Payment failed")}finally{p(!1)}};return e.jsxs("form",{onSubmit:j,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-navy-900",children:"Payment Details"}),e.jsx("div",{className:"flex gap-2",children:e.jsx(T,{className:"w-5 h-5 text-gray-400"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Total Amount Due"}),e.jsxs("p",{className:"text-3xl font-bold text-navy-900",children:["$",(i=s.total)==null?void 0:i.toFixed(2)]})]}),e.jsx("div",{className:"border border-gray-300 rounded-md p-3 mb-4",children:e.jsx(w,{options:{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}}}}})}),y&&e.jsxs("div",{className:"p-3 bg-red-50 text-red-700 text-sm rounded flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4"})," ",y]}),e.jsxs("button",{type:"submit",disabled:!h||c,className:"w-full bg-navy-900 text-white py-3 rounded-lg font-bold hover:bg-navy-800 transition disabled:opacity-50 disabled:cursor-not-allowed flex justify-center items-center gap-2",children:[c?e.jsx(S,{className:"w-4 h-4 animate-spin"}):e.jsx(P,{className:"w-4 h-4"}),c?"Processing...":`Pay $${(d=s.total)==null?void 0:d.toFixed(2)}`]})]}),e.jsxs("p",{className:"text-center text-xs text-gray-500 flex items-center justify-center gap-1",children:[e.jsx(P,{className:"w-3 h-3"})," Secure Payment processed by Stripe"]})]})},z=()=>{var j,i,d,b,N,o,m,x;const{id:s}=C(),[t,h]=n.useState(null),[u,y]=n.useState(!0),[l,c]=n.useState(""),[p,g]=n.useState(!1);return n.useEffect(()=>{(async()=>{try{if(!s)throw new Error("No quote ID");const a=await v.get(`/quotes/public/${s}`);h(a),a.status==="PAID"&&g(!0)}catch{c("Quote not found or invalid.")}finally{y(!1)}})()},[s]),u?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx(S,{className:"w-8 h-8 animate-spin text-navy-900"})}):l||!t?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(E,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-xl font-bold text-navy-900 mb-2",children:"Error"}),e.jsx("p",{className:"text-gray-600",children:l})]})}):p?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-lg max-w-md w-full text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(D,{className:"w-8 h-8 text-green-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-navy-900 mb-2",children:"Payment Successful"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["Thank you! Your payment for Quote #",t.referenceNumber," has been processed."]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg text-sm text-left mb-6",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-gray-500",children:"Amount Paid"}),e.jsxs("span",{className:"font-bold text-navy-900",children:["$",(j=t.total)==null?void 0:j.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Transaction Date"}),e.jsx("span",{className:"font-bold text-navy-900",children:new Date().toLocaleDateString()})]})]}),e.jsx("button",{onClick:()=>window.location.href="/",className:"w-full bg-navy-900 text-white py-2 rounded-lg font-bold hover:bg-navy-800",children:"Return to Home"})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-10",children:[e.jsx("h1",{className:"text-3xl font-bold text-navy-900 mb-2",children:"Complete Your Payment"}),e.jsxs("p",{className:"text-gray-600",children:["Quote #",t.referenceNumber]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-bold text-navy-900 mb-4",children:"Order Summary"}),e.jsx("div",{className:"space-y-4",children:(i=t.items)==null?void 0:i.map((r,a)=>e.jsxs("div",{className:"flex justify-between items-start text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-navy-900",children:r.name||r.sku}),e.jsxs("p",{className:"text-gray-500",children:["Qty: ",r.quantity]})]}),e.jsxs("p",{className:"font-bold text-navy-900",children:["$",((r.unitPrice||0)*(r.quantity||1)).toFixed(2)]})]},a))}),e.jsxs("div",{className:"border-t border-gray-100 my-4 pt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Subtotal"}),e.jsxs("span",{className:"font-medium",children:["$",(d=t.total)==null?void 0:d.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold text-navy-900 pt-2 border-t border-gray-100",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["$",(b=t.total)==null?void 0:b.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-bold text-navy-900 mb-4",children:"Customer Information"}),e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500",children:"Name:"})," ",(N=t.customer)==null?void 0:N.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500",children:"Email:"})," ",(o=t.customer)==null?void 0:o.email]}),((m=t.customer)==null?void 0:m.company)&&e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500",children:"Company:"})," ",(x=t.customer)==null?void 0:x.company]})]})]})]}),e.jsx("div",{children:e.jsx(Q,{stripe:k,children:e.jsx(L,{quote:t,onSuccess:()=>g(!0)})})})]})]})})};export{z as default};
