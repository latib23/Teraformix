import{r as i,j as e,d as b,k as p,f as j}from"./index-CFXgF25F.js";import{D as f}from"./dollar-sign-CrpTMmIA.js";import{S as y}from"./shopping-cart-DYMnb0eQ.js";import{U as N}from"./users-BBsOhU7Q.js";import{P as v}from"./package-utPRiDqv.js";const m=({title:t,value:g,icon:r,color:l,loading:s})=>e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 mb-1",children:t}),s?e.jsx("div",{className:"w-24 h-8 bg-gray-200 rounded animate-pulse mt-1"}):e.jsx("h3",{className:"text-2xl font-bold text-navy-900",children:g})]}),e.jsx("div",{className:`p-3 rounded-lg ${l}`,children:e.jsx(r,{className:"w-6 h-6 text-white"})})]})}),U=()=>{const[t,g]=i.useState(null),[r,l]=i.useState(!0),[s,o]=i.useState("checking");i.useEffect(()=>{(async()=>{l(!0),o("checking");try{const n=p.getUser(),x=((n==null?void 0:n.role)||"BUYER")==="SUPER_ADMIN"?"/dashboard/stats":"/dashboard/sales",u=await j(x);g(u),o("connected")}catch(n){console.error("Failed to load dashboard stats from API.",n);const d=String((n==null?void 0:n.message)||"");d.includes("Not allowed by CORS")?o("disconnected"):d.includes("Unauthorized")||d.includes("401")||d.includes("auth-error")?o("unauthorized"):o("disconnected")}finally{l(!1)}})();const c=()=>o("unauthorized");return window.addEventListener("auth-error",c),()=>window.removeEventListener("auth-error",c)},[]);const h=a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a);return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(m,{title:"Total Revenue",value:t?h(t.totalRevenue):"$0.00",icon:f,color:"bg-action-600",loading:r}),e.jsx(m,{title:"Total Orders",value:t?t.totalOrders.toLocaleString():"0",icon:y,color:"bg-blue-500",loading:r}),e.jsx(m,{title:"Total Customers",value:t?t.totalCustomers.toLocaleString():"0",icon:N,color:"bg-purple-500",loading:r}),e.jsx(m,{title:"Low Stock SKUs",value:t?t.lowStockCount.toLocaleString():"0",icon:v,color:"bg-orange-500",loading:r})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-navy-900 mb-4",children:"Recent Orders"}),r?e.jsx("div",{className:"space-y-2",children:[...Array(5)].map((a,c)=>e.jsx("div",{className:"h-10 bg-gray-100 rounded animate-pulse"},c))}):e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-100 text-gray-500",children:[e.jsx("th",{className:"pb-3 font-medium",children:"Order ID"}),e.jsx("th",{className:"pb-3 font-medium",children:"Customer"}),e.jsx("th",{className:"pb-3 font-medium",children:"Total"}),e.jsx("th",{className:"pb-3 font-medium",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:t!=null&&t.recentOrders&&t.recentOrders.length>0?t.recentOrders.map(a=>{var c,n;return e.jsxs("tr",{className:"group hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 font-mono text-xs text-navy-700",children:e.jsx(b,{to:"/admin/orders",className:"hover:underline",children:a.id.substring(0,8).toUpperCase()})}),e.jsx("td",{className:"py-3 font-medium text-gray-700",children:((c=a.company)==null?void 0:c.name)||((n=a.shippingAddress)==null?void 0:n.firstName)||"Guest"}),e.jsx("td",{className:"py-3 font-semibold text-navy-800",children:h(a.total)}),e.jsx("td",{className:"py-3 text-xs",children:e.jsx("span",{className:"bg-green-100 text-green-700 px-2 py-1 rounded-full",children:a.status})})]},a.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-8 text-gray-400",children:s==="disconnected"?"Cannot fetch orders while offline.":"No recent orders found."})})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-navy-900 mb-4",children:"System Health"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"API Connectivity"}),e.jsxs("span",{className:`flex items-center gap-1.5 text-xs font-bold ${s==="connected"?"text-green-600":s==="checking"?"text-gray-500":"text-orange-500"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${s==="connected"?"bg-green-500":s==="checking"?"bg-gray-400 animate-pulse":"bg-orange-500"}`}),s==="connected"?"Operational":s==="checking"?"Connecting...":s==="unauthorized"?"Login Required":"Offline"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Database Connection"}),e.jsxs("span",{className:`flex items-center gap-1.5 text-xs font-bold ${s==="connected"?"text-green-600":s==="checking"?"text-gray-500":"text-orange-500"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${s==="connected"?"bg-green-500":s==="checking"?"bg-gray-400 animate-pulse":"bg-orange-500"}`}),s==="connected"?"Active":s==="checking"?"Connecting...":s==="unauthorized"?"Login Required":"Offline"]})]}),s!=="connected"&&!r&&e.jsx("div",{className:"mt-4 p-3 bg-orange-50 border border-orange-100 rounded text-xs text-orange-700",children:s==="unauthorized"?e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Admin Login Required:"})," Please sign in to access dashboard data."]}):e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"API Unreachable:"})," The application could not connect to the backend server. Ensure the server is running and the API URL is configured in Settings."]})})]})]})]})]})};export{U as default};
