import{r,b as K,p as j,j as e,L as E,X,S as Y,a as v}from"./index-CFXgF25F.js";import{P as J}from"./plus-CrLdviO7.js";import{F as V}from"./file-down-DFNAX33r.js";import{U as W}from"./user-B-hCEkTO.js";import{T as Z}from"./trash-2-BTQl0KlL.js";const _=({status:d})=>{const l="px-2 py-1 rounded-full text-xs font-bold w-fit";return d==="PROCESSING"?e.jsx("span",{className:`bg-blue-100 text-blue-700 ${l}`,children:"Processing"}):d==="SHIPPED"?e.jsx("span",{className:`bg-purple-100 text-purple-700 ${l}`,children:"Shipped"}):e.jsx("span",{className:`bg-gray-100 text-gray-600 ${l}`,children:d})},y={firstName:"",lastName:"",street:"",city:"",state:"",zip:"",phone:"",email:""},le=()=>{const[d,l]=r.useState([]),[$,w]=r.useState(!0),[R,x]=r.useState(!1),[T,u]=r.useState(!1),[S,C]=r.useState(!1),[i,h]=r.useState([]),[m,b]=r.useState(""),[O,g]=r.useState([]),[P,B]=r.useState("PO"),[A,I]=r.useState(""),[c,k]=r.useState(y),[p,q]=r.useState(y),[f,L]=r.useState(!0),{content:ee}=K(),F=async t=>{},M=async()=>{w(!0);try{try{const t=await v.get("/orders");if(t){l(t),x(!1);return}}catch{const s=await v.get("/orders/my-orders");if(s)l(s),x(!1);else throw new Error("No data")}}catch{x(!0);const s=j.orders.getAll();l(s||[])}finally{w(!1)}};r.useEffect(()=>{M()},[]);const z=()=>{h([]),I(""),B("PO"),g([]),b(""),k(y),q(y),L(!0),u(!0)};r.useEffect(()=>{if(m.length<2){g([]);return}const s=j.products.getAll().filter(a=>a.name.toLowerCase().includes(m.toLowerCase())||a.sku.toLowerCase().includes(m.toLowerCase())).slice(0,5);g(s)},[m]);const G=t=>{h(s=>s.find(n=>n.product.id===t.id)?s.map(n=>n.product.id===t.id?{...n,quantity:n.quantity+1}:n):[...s,{product:t,quantity:1}]),b(""),g([])},U=t=>h(s=>s.filter(a=>a.product.id!==t)),Q=(t,s)=>h(a=>a.map(n=>n.product.id===t?{...n,quantity:Math.max(1,s)}:n)),D=r.useMemo(()=>i.reduce((t,s)=>t+s.product.price*s.quantity,0),[i]),H=async t=>{t.preventDefault(),C(!0);const s={items:i.map(a=>({...a.product,quantity:a.quantity})),total:D,paymentMethod:P,poNumber:P==="PO"?A:void 0,shippingAddress:c,billingAddress:f?c:p,status:"PROCESSING"};try{await v.post("/orders",s),x(!1)}catch{x(!0),j.orders.add({...s,createdAt:new Date().toISOString()})}finally{C(!1),u(!1),await M()}},o=(t,s)=>{const{name:a,value:n}=t.target;s==="shipping"?k(N=>({...N,[a]:n})):q(N=>({...N,[a]:n}))};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-navy-900",children:"My Placed Orders"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Create new orders and track existing ones."})]}),e.jsxs("button",{onClick:z,className:"flex items-center gap-2 px-3 py-2 bg-navy-900 text-white rounded-lg text-sm font-bold hover:bg-navy-800 transition shadow-sm",children:[e.jsx(J,{className:"w-4 h-4"})," Create Order"]})]}),R&&e.jsx("div",{className:"mb-4 text-xs bg-orange-50 border border-orange-100 rounded p-2 text-orange-700",children:"Offline mode: showing local orders only"}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"Order ID"}),e.jsx("th",{className:"px-6 py-3",children:"Customer"}),e.jsx("th",{className:"px-6 py-3",children:"Date"}),e.jsx("th",{className:"px-6 py-3",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right",children:"Total"}),e.jsx("th",{className:"px-6 py-3 w-16",children:"Invoice"})]})}),e.jsx("tbody",{children:$?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center p-8",children:e.jsx(E,{className:"w-6 h-6 animate-spin mx-auto text-gray-400"})})}):d.length>0?d.map(t=>{var s,a;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-6 py-4 font-mono text-xs font-bold text-navy-700",children:t.id}),e.jsxs("td",{className:"px-6 py-4 font-medium text-navy-900",children:[(s=t.shippingAddress)==null?void 0:s.firstName," ",(a=t.shippingAddress)==null?void 0:a.lastName]}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:new Date(t.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(_,{status:t.status})}),e.jsxs("td",{className:"px-6 py-4 text-right font-bold text-navy-900",children:["$",t.total.toLocaleString()]}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("button",{onClick:()=>F(),className:"text-gray-400 hover:text-navy-900 transition p-2 hover:bg-gray-100 rounded-full",title:"Download Invoice",children:e.jsx(V,{className:"w-4 h-4"})})})]},t.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center p-8 text-gray-400",children:"You haven't placed any orders yet."})})})]})})}),T&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-navy-900/50 backdrop-blur-sm animate-fadeIn",children:e.jsxs("form",{onSubmit:H,className:"bg-white rounded-xl w-full max-w-3xl flex flex-col max-h-[90vh] shadow-2xl",children:[e.jsxs("header",{className:"px-6 py-4 border-b flex justify-between items-center bg-gray-50",children:[e.jsx("h3",{className:"text-lg font-bold text-navy-900",children:"Create New Order"}),e.jsx("button",{type:"button",onClick:()=>u(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(X,{className:"w-5 h-5"})})]}),e.jsxs("main",{className:"p-6 overflow-y-auto space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[e.jsxs("h4",{className:"text-sm font-bold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-action-600"})," Customer & PO"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"text-xs font-bold text-navy-900 border-b pb-1 mb-2",children:"Shipping Address"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-2",children:[e.jsx("input",{name:"firstName",required:!0,value:c.firstName,onChange:t=>o(t,"shipping"),placeholder:"First Name",className:"w-full border-gray-300 rounded-lg text-sm bg-white p-2 outline-none focus:ring-2 focus:ring-navy-900"}),e.jsx("input",{name:"lastName",required:!0,value:c.lastName,onChange:t=>o(t,"shipping"),placeholder:"Last Name",className:"w-full border-gray-300 rounded-lg text-sm bg-white p-2 outline-none focus:ring-2 focus:ring-navy-900"})]}),e.jsx("input",{name:"email",type:"email",required:!0,value:c.email,onChange:t=>o(t,"shipping"),placeholder:"Customer Email",className:"w-full border-gray-300 rounded-lg text-sm bg-white mb-2 p-2 outline-none focus:ring-2 focus:ring-navy-900"}),e.jsx("input",{name:"country",value:c.country||"",onChange:t=>o(t,"shipping"),placeholder:"Country",className:"w-full border-gray-300 rounded-lg text-sm bg-white mb-2 p-2 outline-none focus:ring-2 focus:ring-navy-900"})]}),e.jsxs("div",{className:"mb-4 border-t pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h5",{className:"text-xs font-bold text-navy-900",children:"Billing Address"}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-600 select-none cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:t=>L(t.target.checked),className:"rounded text-navy-900 focus:ring-navy-900"}),"Same as Shipping"]})]}),!f&&e.jsxs("div",{className:"space-y-2 animate-in fade-in slide-in-from-top-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{name:"firstName",required:!0,value:p.firstName,onChange:t=>o(t,"billing"),placeholder:"First Name",className:"w-full border-gray-300 rounded-lg text-sm bg-white p-2 outline-none focus:ring-2 focus:ring-navy-900"}),e.jsx("input",{name:"lastName",required:!0,value:p.lastName,onChange:t=>o(t,"billing"),placeholder:"Last Name",className:"w-full border-gray-300 rounded-lg text-sm bg-white p-2 outline-none focus:ring-2 focus:ring-navy-900"})]}),e.jsx("input",{name:"country",value:p.country||"",onChange:t=>o(t,"billing"),placeholder:"Country",className:"w-full border-gray-300 rounded-lg text-sm bg-white p-2 outline-none focus:ring-2 focus:ring-navy-900"})]})]}),e.jsx("div",{className:"border-t pt-4",children:e.jsx("input",{type:"text",value:A,onChange:t=>I(t.target.value),placeholder:"PO Number (Optional)",className:"w-full border-gray-300 rounded-lg text-sm bg-white p-2 outline-none focus:ring-2 focus:ring-navy-900"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 mb-1 block",children:"Add Products"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:m,onChange:t=>b(t.target.value),placeholder:"Search by SKU or Name...",className:"w-full border-gray-300 rounded-lg text-sm bg-white p-2 pl-8 outline-none focus:ring-2 focus:ring-navy-900"}),e.jsx(Y,{className:"absolute left-2.5 top-2.5 w-4 h-4 text-gray-400"}),O.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border rounded-lg shadow-lg z-10 max-h-60 overflow-y-auto",children:O.map(t=>e.jsxs("div",{onClick:()=>G(t),className:"p-3 hover:bg-gray-100 cursor-pointer border-b last:border-0 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-navy-900",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t.sku})]}),e.jsxs("span",{className:"text-sm font-bold text-action-600",children:["$",t.price.toLocaleString()]})]},t.id))})]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left font-medium",children:"Product"}),e.jsx("th",{className:"p-2 w-24 font-medium text-center",children:"Qty"}),e.jsx("th",{className:"p-2 w-28 text-right font-medium",children:"Price"}),e.jsx("th",{className:"p-2 w-16"})]})}),e.jsx("tbody",{children:i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"p-4 text-center text-gray-400 text-xs",children:"No products added yet."})}):i.map(t=>e.jsxs("tr",{className:"border-b last:border-0",children:[e.jsxs("td",{className:"p-2",children:[e.jsx("div",{className:"text-navy-900 font-medium",children:t.product.name}),e.jsx("div",{className:"text-xs text-gray-500 font-mono",children:t.product.sku})]}),e.jsx("td",{className:"p-2 w-24",children:e.jsx("input",{type:"number",min:"1",value:t.quantity,onChange:s=>Q(t.product.id,parseInt(s.target.value)),className:"w-full border-gray-300 rounded text-sm text-center p-1"})}),e.jsxs("td",{className:"p-2 w-28 text-right font-semibold",children:["$",(t.product.price*t.quantity).toLocaleString()]}),e.jsx("td",{className:"p-2 w-16 text-center",children:e.jsx("button",{type:"button",onClick:()=>U(t.product.id),className:"text-gray-400 hover:text-red-500 p-1",children:e.jsx(Z,{className:"w-4 h-4"})})})]},t.product.id))}),e.jsx("tfoot",{className:"bg-gray-50 font-bold border-t border-gray-200",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:2,className:"p-2 text-right",children:"Total:"}),e.jsxs("td",{className:"p-2 text-right",children:["$",D.toLocaleString()]}),e.jsx("td",{})]})})]})})]}),e.jsxs("footer",{className:"px-6 py-4 border-t bg-gray-50 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>u(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-200 rounded-lg transition",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:S||i.length===0,className:"px-4 py-2 bg-navy-900 text-white text-sm font-bold rounded-lg shadow-sm disabled:bg-gray-300 flex items-center gap-2 hover:bg-navy-800 transition",children:[S&&e.jsx(E,{className:"w-4 h-4 animate-spin"}),"Create Order"]})]})]})})]})};export{le as default};
